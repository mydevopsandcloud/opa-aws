package wiz

import data.generic.common as common_lib
import data.generic.terraform as terralib

WizPolicy[result] {
    # Only check aws_networkfirewall_rule_group resources
    resourceType := ["aws_networkfirewall_rule_group"]
    some idx
    some name

    resource := input.document[i].resource[resourceType[idx]][name]

    # Check if the resource type is not STATELESS
    not terralib.validKey(resource, "type")
    resource.type != "STATELESS"

    result := {
        "documentId": input.document[i].id,
        "resourceName": terralib.get_resource_name(resource, name),
        "resourceType": resourceType[idx],
        "searchKey": sprintf("%s[%s].type", [resourceType[idx], name]),
        "issueType": "InvalidConfiguration",
        "keyExpectedValue": "'type' should be 'STATELESS'",
        "keyActualValue": sprintf("type is '%s'", [resource.type]),
        "resourceTags": object.get(resource, "tags", {}),
    }
}
